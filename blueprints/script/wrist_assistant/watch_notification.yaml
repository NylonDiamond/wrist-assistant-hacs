blueprint:
  name: "Watch Notification"
  author: "Wrist Assistant"
  description: >
    Send actionable push notifications to your Apple Watch.


    Define up to 4 action buttons. Pick an entity, give the button a label,
    and choose which service to call when tapped.


    Leave action slots empty to skip them. A notification with no actions
    shows as info-only (title + message, no buttons).
  domain: script
  input:
    message:
      name: Message
      description: Notification body text.
      selector:
        text:
    title:
      name: Title
      description: Optional title displayed above the message.
      default: ""
      selector:
        text:

    section_action_1:
      name: Action 1
      icon: mdi:gesture-tap-button
      collapsed: false
      input:
        action_1_entity:
          name: Entity
          description: Entity for this action button to act on.
          default: ""
          selector:
            entity:
        action_1_title:
          name: Button Label
          description: >
            Text shown on the button. Leave blank to auto-generate
            from the service name (e.g. "Turn On").
          default: ""
          selector:
            text:
        action_1_service:
          name: Service
          description: >
            Service to call when tapped. Domain is auto-detected
            from the entity.
          default: ""
          selector:
            select:
              custom_value: true
              mode: dropdown
              options:
                - label: "None"
                  value: ""
                - label: "Toggle"
                  value: "toggle"
                - label: "Turn On"
                  value: "turn_on"
                - label: "Turn Off"
                  value: "turn_off"
                - label: "Lock"
                  value: "lock"
                - label: "Unlock"
                  value: "unlock"
                - label: "Open Cover"
                  value: "open_cover"
                - label: "Close Cover"
                  value: "close_cover"
                - label: "Open Valve"
                  value: "open_valve"
                - label: "Close Valve"
                  value: "close_valve"
                - label: "Arm Home"
                  value: "alarm_arm_home"
                - label: "Arm Away"
                  value: "alarm_arm_away"
                - label: "Disarm"
                  value: "alarm_disarm"
                - label: "Start (vacuum)"
                  value: "start"
                - label: "Pause (vacuum)"
                  value: "pause"
                - label: "Return to Base (vacuum)"
                  value: "return_to_base"
                - label: "Activate (scene)"
                  value: "turn_on"

    section_action_2:
      name: Action 2
      icon: mdi:gesture-tap-button
      collapsed: true
      input:
        action_2_entity:
          name: Entity
          description: Entity for this action button to act on.
          default: ""
          selector:
            entity:
        action_2_title:
          name: Button Label
          description: Text shown on the button.
          default: ""
          selector:
            text:
        action_2_service:
          name: Service
          description: >
            Service to call when tapped. Domain is auto-detected
            from the entity.
          default: ""
          selector:
            select:
              custom_value: true
              mode: dropdown
              options:
                - label: "None"
                  value: ""
                - label: "Toggle"
                  value: "toggle"
                - label: "Turn On"
                  value: "turn_on"
                - label: "Turn Off"
                  value: "turn_off"
                - label: "Lock"
                  value: "lock"
                - label: "Unlock"
                  value: "unlock"
                - label: "Open Cover"
                  value: "open_cover"
                - label: "Close Cover"
                  value: "close_cover"
                - label: "Open Valve"
                  value: "open_valve"
                - label: "Close Valve"
                  value: "close_valve"
                - label: "Arm Home"
                  value: "alarm_arm_home"
                - label: "Arm Away"
                  value: "alarm_arm_away"
                - label: "Disarm"
                  value: "alarm_disarm"
                - label: "Start (vacuum)"
                  value: "start"
                - label: "Pause (vacuum)"
                  value: "pause"
                - label: "Return to Base (vacuum)"
                  value: "return_to_base"
                - label: "Activate (scene)"
                  value: "turn_on"

    section_action_3:
      name: Action 3
      icon: mdi:gesture-tap-button
      collapsed: true
      input:
        action_3_entity:
          name: Entity
          description: Entity for this action button to act on.
          default: ""
          selector:
            entity:
        action_3_title:
          name: Button Label
          description: Text shown on the button.
          default: ""
          selector:
            text:
        action_3_service:
          name: Service
          description: >
            Service to call when tapped. Domain is auto-detected
            from the entity.
          default: ""
          selector:
            select:
              custom_value: true
              mode: dropdown
              options:
                - label: "None"
                  value: ""
                - label: "Toggle"
                  value: "toggle"
                - label: "Turn On"
                  value: "turn_on"
                - label: "Turn Off"
                  value: "turn_off"
                - label: "Lock"
                  value: "lock"
                - label: "Unlock"
                  value: "unlock"
                - label: "Open Cover"
                  value: "open_cover"
                - label: "Close Cover"
                  value: "close_cover"
                - label: "Open Valve"
                  value: "open_valve"
                - label: "Close Valve"
                  value: "close_valve"
                - label: "Arm Home"
                  value: "alarm_arm_home"
                - label: "Arm Away"
                  value: "alarm_arm_away"
                - label: "Disarm"
                  value: "alarm_disarm"
                - label: "Start (vacuum)"
                  value: "start"
                - label: "Pause (vacuum)"
                  value: "pause"
                - label: "Return to Base (vacuum)"
                  value: "return_to_base"
                - label: "Activate (scene)"
                  value: "turn_on"

    section_action_4:
      name: Action 4
      icon: mdi:gesture-tap-button
      collapsed: true
      input:
        action_4_entity:
          name: Entity
          description: Entity for this action button to act on.
          default: ""
          selector:
            entity:
        action_4_title:
          name: Button Label
          description: Text shown on the button.
          default: ""
          selector:
            text:
        action_4_service:
          name: Service
          description: >
            Service to call when tapped. Domain is auto-detected
            from the entity.
          default: ""
          selector:
            select:
              custom_value: true
              mode: dropdown
              options:
                - label: "None"
                  value: ""
                - label: "Toggle"
                  value: "toggle"
                - label: "Turn On"
                  value: "turn_on"
                - label: "Turn Off"
                  value: "turn_off"
                - label: "Lock"
                  value: "lock"
                - label: "Unlock"
                  value: "unlock"
                - label: "Open Cover"
                  value: "open_cover"
                - label: "Close Cover"
                  value: "close_cover"
                - label: "Open Valve"
                  value: "open_valve"
                - label: "Close Valve"
                  value: "close_valve"
                - label: "Arm Home"
                  value: "alarm_arm_home"
                - label: "Arm Away"
                  value: "alarm_arm_away"
                - label: "Disarm"
                  value: "alarm_disarm"
                - label: "Start (vacuum)"
                  value: "start"
                - label: "Pause (vacuum)"
                  value: "pause"
                - label: "Return to Base (vacuum)"
                  value: "return_to_base"
                - label: "Activate (scene)"
                  value: "turn_on"

    section_options:
      name: Options
      icon: mdi:tune
      collapsed: true
      input:
        priority:
          name: Priority
          description: >
            Interruption level. Passive delivers silently, Active is the
            default, Time Sensitive breaks through Focus/DND, Critical
            overrides mute.
          default: "active"
          selector:
            select:
              mode: dropdown
              options:
                - label: "Passive (silent delivery)"
                  value: "passive"
                - label: "Active (default)"
                  value: "active"
                - label: "Time Sensitive (breaks Focus)"
                  value: "time-sensitive"
                - label: "Critical (overrides mute)"
                  value: "critical"
        sound:
          name: Sound
          description: Notification sound.
          default: "default"
          selector:
            select:
              mode: dropdown
              options:
                - label: "Default sound"
                  value: "default"
                - label: "Silent"
                  value: ""
        target:
          name: Target Watch
          description: >
            Watch to send to. Leave empty to send to all registered watches.
          default: ""
          selector:
            device:
              filter:
                - integration: wrist_assistant
        tag:
          name: Tag
          description: >
            Collapse key. A new notification with the same tag replaces the
            previous one instead of stacking.
          default: ""
          selector:
            text:
        group:
          name: Group
          description: >
            Thread ID to group related notifications together in the watch
            notification center.
          default: ""
          selector:
            text:

mode: parallel
max: 10

sequence:
  - variables:
      bp_message: !input message
      bp_title: !input title
      bp_a1_entity: !input action_1_entity
      bp_a1_title: !input action_1_title
      bp_a1_service: !input action_1_service
      bp_a2_entity: !input action_2_entity
      bp_a2_title: !input action_2_title
      bp_a2_service: !input action_2_service
      bp_a3_entity: !input action_3_entity
      bp_a3_title: !input action_3_title
      bp_a3_service: !input action_3_service
      bp_a4_entity: !input action_4_entity
      bp_a4_title: !input action_4_title
      bp_a4_service: !input action_4_service
      bp_priority: !input priority
      bp_sound: !input sound
      bp_target_device: !input target
      bp_tag: !input tag
      bp_group: !input group
  - service: wrist_assistant.send_notification
    data: >
      {%- set d = namespace(items=[("message", bp_message), ("priority", bp_priority)]) -%}
      {%- if bp_title %}{%- set d.items = d.items + [("title", bp_title)] -%}{%- endif -%}
      {%- if bp_sound %}{%- set d.items = d.items + [("sound", bp_sound)] -%}{%- endif -%}
      {%- if bp_target_device -%}
        {%- set ids = device_attr(bp_target_device, 'identifiers') | list -%}
        {%- if ids %}{%- set d.items = d.items + [("target", ids[0][1] | replace('watch_', ''))] -%}{%- endif -%}
      {%- endif -%}
      {%- if bp_tag %}{%- set d.items = d.items + [("tag", bp_tag)] -%}{%- endif -%}
      {%- if bp_group %}{%- set d.items = d.items + [("group", bp_group)] -%}{%- endif -%}
      {%- set actions = namespace(list=[]) -%}
      {%- set slots = [
        (bp_a1_entity, bp_a1_title, bp_a1_service),
        (bp_a2_entity, bp_a2_title, bp_a2_service),
        (bp_a3_entity, bp_a3_title, bp_a3_service),
        (bp_a4_entity, bp_a4_title, bp_a4_service),
      ] -%}
      {%- for entity, title, svc in slots -%}
        {%- if entity and svc -%}
          {%- set domain = entity.split('.')[0] -%}
          {%- set btn_title = title if title else svc | replace('_', ' ') | title -%}
          {%- set a = namespace(items=[("title", btn_title), ("domain", domain), ("service", svc), ("entity_id", entity)]) -%}
          {%- set actions.list = actions.list + [dict(a.items)] -%}
        {%- endif -%}
      {%- endfor -%}
      {%- if actions.list %}{%- set d.items = d.items + [("actions", actions.list)] -%}{%- endif -%}
      {{ dict(d.items) }}
